<!doctype html>
<html lang="uk">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Практика та тест — SlovakQuiz</title>
  <link rel="stylesheet" href="css/style.css" />
  <link rel="stylesheet" href="css/style_courses.css" />
</head>
<body>
<header class="topbar">
  <a class="logo" href="index.html">Slovak<span>Quiz</span></a>

  <div class="lang-switch" id="langSwitch">
    <button class="lang-btn" aria-label="Language">
     <span>Українська</span> <span class="chev">▾</span>
    </button>

    <div class="lang-menu hidden" id="langMenu">
      <button class="lang-item" data-lang="uk"> Українська</button>
      <button class="lang-item" data-lang="en"> English</button>
      <button class="lang-item" data-lang="sk"> Slovenčina</button>
    </div>
  </div>
</header>
<main class="hero">
<section class="hero-card test-layout-single">
    <div id="content-area">
      <h1 data-i18n="practice_title">Практика та тест</h1>
      <p class="hint" data-i18n="practice_hint">Це сторінка з практикою і тестом. Вона відкриється, коли всі теоретичні теми пройдені.</p>
      <div id="locked" style="display:none;">
        <p data-i18n="practice_locked">Ще не всі теорії пройдені — поверніться до курсу.</p>
        <a href="into_course.html" class="btn btn-link" data-i18n="return_to_course">Повернутися до курсу</a>
      </div>
      <div id="practice" style="display:none;">
        <!-- embedded test UI; styles/scripts will be loaded only when unlocked -->

        <div class="test-area">
          <h2 data-i18n="test_title">Тест — словникові вправи</h2>

          <div class="progress-wrap">
            <div class="progress-label"><span id="progressText">0%</span></div>
            <div class="progress-bar" id="progressBar" aria-hidden="false">
              <div class="progress-fill" id="progressFill" style="width:0%"></div>
            </div>
          </div>

          <div class="question-card" id="questionCard">
            <div class="question-prompt" id="prompt">Prompt</div>
            <div class="choices" id="choices"></div>
          </div>

          <div class="controls">
            <button id="prevBtn" class="btn btn-link" disabled data-i18n="btn_prev">Назад</button>
            <button id="nextBtn" class="btn btn-primary" disabled data-i18n="btn_next">Далі</button>
          </div>

          <div id="result" class="result hidden">
            <h3 data-i18n="result_title">Результат</h3>
            <p id="resultText"></p>
            <a href="into_course.html" class="btn btn-link" data-i18n="return_to_course">Повернутися до курсу</a>
          </div>

        </div>

        <!-- test script loaded dynamically when unlocked -->
      </div>
    </div>
  </section>
</main>
<script src="js/i18n.js"></script>
<script src="js/lang-ui.js"></script>
<script src="js/into-course.js"></script>
<script>
  (function(){
    const courseIds = ['course-1','course-2','course-3','course-4'];
    let testLoaded = false;

    function loadTestOnce(){
      if (testLoaded) return;
      testLoaded = true;
      const practice = document.getElementById('practice');
      practice.style.display = 'block';
      // load test stylesheet
      const link = document.createElement('link');
      link.rel = 'stylesheet';
      link.href = 'css/style_test.css';
      document.head.appendChild(link);
      // load test script and start when ready
      const s = document.createElement('script');
      s.src = 'js/test.js';
      s.onload = () => { if (window.testStart) window.testStart(); };
      document.body.appendChild(s);
    }

    function checkUnlock(){
      const allDone = courseIds.every(id => (window.isDone ? window.isDone(id) : (localStorage.getItem('done:' + id) === '1' || localStorage.getItem('done:' + id) === 'true')));
      if (allDone) {
        document.getElementById('locked').style.display = 'none';
        loadTestOnce();
      } else {
        // only show locked if test not already loaded
        if (!testLoaded) document.getElementById('locked').style.display = 'block';
      }
    }

    // initial check
    checkUnlock();

    // listen for changes from other tabs/windows (or scripts)
    window.addEventListener('storage', (e) => {
      if (!e.key) return; // clear or other
      // if any of the done: keys changed, re-check
      if (e.key.startsWith('done:')) checkUnlock();
    });
  })();
</script>
</body>
</html>
